<!DOCTYPE html>
<html>
  <head>
    <title>Live People Map</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY"></script>
    <style>
      #map { height: 100vh; width: 100%; }
    </style>
  </head>
  <body>
    <div id="map"></div>

    <script>
      const socket = io();
      let map;
      let markers = {};

      function initMap(lat, lon) {
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat, lng: lon },
          zoom: 15
        });
      }

      // Get my location
      navigator.geolocation.watchPosition((pos) => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;

        if (!map) initMap(lat, lon);

        // Send to server
        socket.emit("sendLocation", { lat, lon });
      });

      // Receive all usersâ€™ locations
      socket.on("updateLocations", (users) => {
        for (let id in markers) {
          markers[id].setMap(null); // clear old markers
        }
        markers = {};

        for (let id in users) {
          const { lat, lon } = users[id];
          markers[id] = new google.maps.Marker({
            position: { lat, lng: lon },
            map,
            label: id === socket.id ? "Me" : "ðŸ‘¤"
          });
        }
      });
    </script>
  </body>
</html>
